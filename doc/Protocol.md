# Arduino - node.js間の通信仕様

定めるで！

## 物理層

* 通信方式 : シリアルポート(RS232)
* ボーレート : 115200bps
* パリティ : 無し
* データビット長 : 8
* ストップビット : 1
* フロー制御 : 無し

## アプリケーション層

### 共通事項

Arduinoとnode.jsは互いに文字列を用いて通信を行う。

バイナリに意味を持たせて行う通信に比べ文字列で行う通信は冗長であるが、デバッグの容易さ、またnode.jsとの相性を踏まえ、文字列をベースとした通信を採用した。

現段階(2031/04/01)では、基本的にnode.jsからArduinoへ指示が送られ、Arduinoはそれに対してレスポンスを返すという流れになる。

※これは将来的にイベント検出や、AD値のストリーミングなどの機能追加によって変更される可能性がある。

### node.js
node.jsからArduinoへはURLに似た構造を持つ文字列で情報が送られる。

一つの情報は改行コード(\n)で区切られる。

例) Analog Inputポートの3の値を読む

```txt
ai/read/3\n
```

### Arduino

Arduinoからnode.jsへはJSONにparse可能な文字列で情報が送られる。

一つの情報の単位はキャリッジリターンと改行コード(\r\n)で区切られる。
これはArduinoの仕様に基づく。

例) ai/read/3に対してのレスポンス

```js
{"msg":"OK","port":3,"val":100}\r\n
```

なお例外的にArduinoリセット時にはArduinoから"READY\r\n"という文字列が送信される(ダブルコーテーションは含まない)。

これはArduinoが予期しないタイミングでリセットが掛かったことを検出する為に行なっている。


## 具体的な通信方法
[こちらです](CommandAndResponse.md)
